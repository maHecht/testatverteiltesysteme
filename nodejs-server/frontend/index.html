<!DOCTYPE html>
<html>

<head>
    <title>Blackboards</title>
    <script src="https://code.jquery.com/jquery-latest.js"></script>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="stylesheet/style.css">
    <script type="text/javascript" src="scripts/blackboardScript.js"></script>
</head>

<body>
    <div class="Titel">
        Blackboards
    </div>
    <div class="BlackboardContainer" id="BlackboardContainer">
        <script type="text/javascript">
            function listBlackboards(blackboardlist){
                var container = document.getElementById("BlackboardContainer");
                while(container.firstChild){
                    container.firstChild.remove();
                }

                //blackboardlist = JSON.parse(blackboardlist);
                //Aufbau JSON
                /*
                Name
                Message
                Timestamp
                */
                var numberBoards = 0;
                for(var boards in blackboardlist.blackboards){
                    if(blackboardlist.blackboards.hasOwnProperty(boards)){
                        numberBoards++;
                    }
                }
                for(var i = 0; i < numberBoards; i++){
                    //Create Div: Blackboard
                    var blackboard = document.createElement("div");
                    blackboard.id = "blackboards" + i;
                    blackboard.className = "Blackboard";

                    //Create Div: Vorschau Nachricht 
                    var messageDiv = document.createElement("div");
                    messageDiv.className = "blackboardText";
                    
                    //enbale change of text of message div
                    messageDiv.contentEditable = "true";                

                    //get message
                    var message = blackboardlist.blackboards[i].message;
                    var previewMessage;

                    //check if message is longer than 20 characters
                    if(message.length > 20){
                        //save original message for later usage in detailed view
                        var origMessage = message;

                        //truncat string to shorter preview message
                        var index = message.indexOf(' ', message.indexOf(' ') +1);
                        var previewString = index >= 0 ? message.substr(0, index) : message.substr(index +1);
                        var endDots = '...';
                        previewMessage = document.createTextNode(previewString + endDots);
                    } else{
                        previewMessage = document.createTextNode(message);
                    }
                    messageDiv.appendChild(previewMessage);

                    //Create Div: Namen
                    var nameDiv = document.createElement("div");
                    nameDiv.className = "blackboardHeader";
                    nameDiv.id = blackboard.id + "nameDiv";
                    
                    //get name of board
                    var boardName = blackboardlist.blackboards[i].name;
                    var nameNode = document.createTextNode(boardName);
                    nameDiv.appendChild(nameNode);
                    
                    //Append Divs
                    blackboard.appendChild(nameDiv);
                    blackboard.appendChild(messageDiv);

                    //define on click for blackbaord
                    blackboard.onclick = function(){
                        var board = document.getElementById(this.id);
                        board.setAttribute("class", "ForegroundBoard");
                        var name = board.firstChild.textContent;
                        readBlackboard(name, this.id);
                    };

                    //add buttons
                    var buttonSave = document.createElement("BUTTON");
                    var buttonClear = document.createElement("BUTTON");
                    var buttonDelete = document.createElement("BUTTON");
                    var buttonClose = document.createElement("BUTTON");

                    buttonSave.innerText = "Save";
                    buttonClear.innerText = "Clear";
                    buttonDelete.innerText = "Delete";
                    buttonClose.innerText = "Close";

                    buttonSave.className = "blackboardButton";
                    buttonClear.className = "blackboardButton";
                    buttonDelete.className = "blackboardButton";
                    buttonClose.className = "blackboardButton";

                    buttonSave.id = blackboard.id + "saveButton";
                    buttonClear.id = blackboard.id + "clearButton";
                    buttonDelete.id = blackboard.id + "deleteButton";
                    buttonClose.id = blackboard.id + "closeButton";


                    buttonSave.onclick = function(){
                        event.stopPropagation(); //-> used to not trigger blackboards on click method
                        var thisButton = document.getElementById(this.id);
                        var board = thisButton.parentElement;

                        var name = board.firstChild.textContent;
                        for (var i = 0; i < board.childNodes.length; i++) {
                            if(board.childNodes[i].className == "blackboardText"){
                                message = board.childNodes[i].textContent;
                            }
                        }
                        updateBlackboard(name, message);
                    }
                    buttonClear.onclick = function(){
                        event.stopPropagation(); //-> used to not trigger blackboards on click method
                        var thisButton = document.getElementById(this.id);
                        var board = thisButton.parentElement;

                        var name = board.firstChild.textContent;
                        for (var i = 0; i < board.childNodes.length; i++) {
                            if(board.childNodes[i].className == "blackboardText"){
                                board.childNodes[i].textContent = "";
                            }
                        }
                        clearBlackboard(name);
                    }
                    buttonDelete.onclick = function(){
                        event.stopPropagation(); //-> used to not trigger blackboards on click method
                        var thisButton = document.getElementById(this.id);
                        var board = thisButton.parentElement;
                        var name = board.firstChild.textContent;

                        deleteBlackboard(name);
                        board.remove();
                    }
                    buttonClose.onclick = function(){
                        event.stopPropagation(); //-> used to not trigger blackboards on click method
                        var thisButton = document.getElementById(this.id);
                        var board = thisButton.parentElement;
                        board.setAttribute("class", "Blackboard");
                        
                        for (var i = 0; i < board.childNodes.length; i++) {
                            //hide buttons
                            if (board.childNodes[i].className == "blackboardButton") {
                                board.childNodes[i].style.display = 'none';
                            } 
                        }
                    }
                    //apend buttons to blackboard but deactivate them
                    blackboard.appendChild(buttonSave);
                    blackboard.appendChild(buttonClear);
                    blackboard.appendChild(buttonDelete);
                    blackboard.appendChild(buttonClose);

                    //Blackboard Div an Container anhÃ¤ngen
                    document.getElementById("BlackboardContainer").appendChild(blackboard);
                }
            }
            getBlackboards(listBlackboards);
        </script>
    </div>
    <div class="Add" id="addBlackboardIcon" onclick="openForm()">
        <img src="Rotes_Plus.png" alt="Add Blackboard" width="40vh" height="40vh">
		<script type="text/javascript">
			function openForm() {
			    document.getElementById("myForm").style.display = "block";
			}

			function closeForm() {
			    document.getElementById("myForm").style.display = "none";
			}
			
			function createBlackboards() {
				var blackboardTitle = document.getElementById("title").value;
				console.log("dies ist ein test");
				createBlackboard(blackboardTitle);
				getBlackboards(listBlackboards);
				document.getElementById("myForm").style.display = "none";
			}
		</script>
    </div>
	<div class="popup popup-container" id="myForm">
		
			<h1>Create Blackboard</h1>

			<label for="name"><b>Name</b></label>
			<input id="title" type="text" placeholder="Enter Blackboard Name" name="name" required>

			<button type="submit" class="btn" onclick="createBlackboards()">Submit</button>
			<button type="button" class="btn cancel" onclick="closeForm()">Close</button>
		
	</div>
</body>

</html>
